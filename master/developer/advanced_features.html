

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Advanced Features &mdash; WEC-Sim  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="WEC-Sim Library" href="library.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WEC-Sim
          

          
          </a>

          
            
            
              <div class="version">
                v4.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/index.html">Theory Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="pull_requests.html">Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_tests.html">Software Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="library.html">WEC-Sim Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#added-mass">Added Mass</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WEC-Sim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Developer Manual</a> &raquo;</li>
        
      <li>Advanced Features</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developer/advanced_features.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            


  <div class="section" id="advanced-features">
<span id="dev-advanced-features"></span><h1>Advanced Features<a class="headerlink" href="#advanced-features" title="Permalink to this headline">¶</a></h1>
<div class="section" id="added-mass">
<h2>Added Mass<a class="headerlink" href="#added-mass" title="Permalink to this headline">¶</a></h2>
<p id="dev-added-mass">Added mass is a special multi-directional fluid dynamic phenomenon that most
physics software cannot account for well. WEC-Sim uses a special added mass
treatment to get around the current limitations of Simscape Multibody. For the
most robust simulation, the added mass matrix should be combined with the mass
and inertia, shown in the manipulation of the governing equation below:</p>
<div class="math notranslate nohighlight">
\[\begin{split}m\ddot{X_i} &amp;= \Sigma F(t,\omega) - A\ddot{X_i} \\
(m+A)\ddot{X_i} &amp;= \Sigma F(t,\omega) \\
M_{adjusted}\ddot{X_i} &amp;= \Sigma F(t,\omega)\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the mass, <span class="math notranslate nohighlight">\(I\)</span> is the moment of inertia, <span class="math notranslate nohighlight">\(A\)</span> is the added mass, and subscript <span class="math notranslate nohighlight">\(i\)</span> represents the timestep being solved for.
In this case, the mass of a body is set to the sum of the translational mass, rotational inertia and the added mass matrix:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted} = \begin{bmatrix}
                   m + A_{1,1} &amp; A_{1,2} &amp; A_{1,3} &amp; A_{1,4} &amp; A_{1,5} &amp; A_{1,6} \\
                   A_{2,1} &amp; m + A_{2,2} &amp; A_{2,3} &amp; A_{2,4} &amp; A_{2,5} &amp; A_{2,6} \\
                   A_{3,1} &amp; A_{3,2} &amp; m + A_{3,3} &amp; A_{3,4} &amp; A_{3,5} &amp; A_{3,6} \\
                   A_{4,1} &amp; A_{4,2} &amp; A_{4,3} &amp; I_{4,4} + A_{4,4} &amp; A_{4,5} &amp; A_{4,6} \\
                   A_{5,1} &amp; A_{5,2} &amp; A_{5,3} &amp; A_{5,4} &amp; I_{5,5} + A_{5,5} &amp; A_{5,6} \\
                   A_{6,1} &amp; A_{6,2} &amp; A_{6,3} &amp; A_{6,4} &amp; A_{6,5} &amp; I_{6,6} + A_{6,6} \\
               \end{bmatrix}\end{split}\]</div>
<p>This formulation is ideal because it removes the acceleration dependence from the right hand side of the equation.
Without this treatment, the acceleration creates an unsolvable algebraic loop.
There are ways to get around this issue, but simulation robustness and stability become more difficult.</p>
<p>The core issue with this combined mass formulation is that Simscape does not allow a generic body to have a degree-of-freedom specific mass.
A Simscape body is only allowed to have one translational mass and three values of inertia about each translational axis.</p>
<p>Due to this limitation, WEC-Sim cannot combine the mass and added mass on the left-hand side of the equation of motion (as shown above).
Instead, WEC-Sim moves some components of added mass, while the majority of the components remain on the right-hand side.
There is a 1-1 mapping between rotational inertia and the roll-roll (4,4), pitch-pitch (5,5), yaw-yaw (6,6) added mass components.
Additionally, some combination of the surge-surge (1,1), sway-sway (2,2), heave-heave (3,3) components correspond to the translational mass of the body. Therefore, WEC-Sim treats the added mass in the following way:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted} &amp;= m + \alpha Y \\\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}Y &amp;= (A_{1,1} + A_{2,2} + A_{3,3}) \\\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}I_{adjusted} &amp;= \begin{bmatrix}
                   I_{4,4} + A_{4,4} \\
                   I_{5,5} + A_{5,5} \\
                   I_{6,6} + A_{6,6} \\
               \end{bmatrix} \\
A_{adjusted} &amp;= \begin{bmatrix}
                   A_{1,1} - \alpha Y &amp; A_{1,2} &amp; A_{1,3} &amp; A_{1,4} &amp; A_{1,5} &amp; A_{1,6} \\
                   A_{2,1} &amp; A_{2,2} - \alpha Y &amp; A_{2,3} &amp; A_{2,4} &amp; A_{2,5} &amp; A_{2,6} \\
                   A_{3,1} &amp; A_{3,2} &amp; A_{3,3} - \alpha Y &amp; A_{3,4} &amp; A_{3,5} &amp; A_{3,6} \\
                   A_{4,1} &amp; A_{4,2} &amp; A_{4,3} &amp; 0 &amp; A_{4,5} &amp; A_{4,6} \\
                   A_{5,1} &amp; A_{5,2} &amp; A_{5,3} &amp; A_{5,4} &amp; 0 &amp; A_{5,6} \\
                   A_{6,1} &amp; A_{6,2} &amp; A_{6,3} &amp; A_{6,4} &amp; A_{6,5} &amp; 0\\
               \end{bmatrix}\end{split}\]</div>
<p>The factor <span class="math notranslate nohighlight">\(\alpha\)</span> represents <code class="docutils literal notranslate"><span class="pre">simu.adjMassWeightFun</span> <span class="pre">=2</span></code>, the default value.</p>
<p>The summation of the adjusted mass, inertia and added mass is identical to the original summation above.
The governing equation of motion does not change, only its implementation.
A simulation class weight factor controls the degree to which the added mass is adjusted to create the most robust simulation possible.
To see its effects, set <code class="docutils literal notranslate"><span class="pre">simu.adjMassWeightFun</span> <span class="pre">=</span> <span class="pre">0</span></code> and WEC-Sim will likely become unstable.</p>
<p>However WEC-Sim again contains an unsolvable algebraic loop due to the acceleration dependence.
WEC-Sim removes this algebraic problem using a <a class="reference external" href="https://www.mathworks.com/help/simulink/slref/transportdelay.html">Simulink Transport Delay</a> with a very small time delay (<code class="docutils literal notranslate"><span class="pre">1e-8</span></code>).
This typically results in using the acceleration at a previous time step to calculate the added mass force.
However, since the time delay is smaller than the simulation time step Simulink will extrapolate the previous step to within 1e-8 of the current time step.
This will convert the algebraic loop equation of motion to a solvable one:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_{adjusted}\ddot{X_i} &amp;= \Sigma F(t,\omega) - A_{adjusted}\ddot{X}_{i - (10^{-8}/dt)} \\\end{split}\]</div>
<p>The acceleration used for the added mass represents the previous time step (<span class="math notranslate nohighlight">\(i-1\)</span>) interpolated to <code class="docutils literal notranslate"><span class="pre">1e-8</span></code> seconds before the current time step being solved.
This can be thought of as a <code class="docutils literal notranslate"><span class="pre">i-0.001%</span></code> time step; a close approximation of the current time step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on the wave formulation used, <span class="math notranslate nohighlight">\(A\)</span> can either be a function of wave frequency <span class="math notranslate nohighlight">\(A(\omega)\)</span>, or equal to the added mass at infinite wave frequency <span class="math notranslate nohighlight">\(A_{\infty}\)</span></p>
</div>
</div>
</div>



           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="library.html" class="btn btn-neutral float-left" title="WEC-Sim Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, National Renewable Energy Laboratory and National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: master
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="advanced_features.html">master</a></dd>
      <dd><a href="../../dev/developer/advanced_features.html">dev</a></dd>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-88158104-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>